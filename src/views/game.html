<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Snake Shit Type</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">

    <script src="/socket.io/socket.io.js"></script>

</head>
<body class='h-100 text-center text-white bg-dark'>
  
    <div class="cover-container d-flex w-100 h-100 p-3 mx-auto flex-column mw-70" style='max-width:60%;'>
        <header class="mb-auto">
          <div>
            <h3 class="float-md-start mb-0">Cover</h3>
            <nav class="nav nav-masthead justify-content-center float-md-end">
              <a class="nav-link active" aria-current="page" href="#">Home</a>
              <a class="nav-link" href="#">Features</a>
              <a class="nav-link" href="#">Contact</a>
            </nav>
          </div>
        </header>

        <main class="px-3" style='padding-top:10%;'>
          
          <h1>Snake Type Shit.</h1>
          <p></p>
          <canvas id="myScreen" width='500' height='500' ></canvas>  
        </main>

        <footer class="mt-auto text-white-50">
          <p> Snake </p>
        </footer>
      </div>      
      <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.1/dist/umd/popper.min.js" integrity="sha384-SR1sx49pcuLnqZUnnPwx6FCym0wLsk5JZuNx2bPPENzswTNFaQU1RDvt3wT4gWFG" crossorigin="anonymous"></script>
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.min.js" integrity="sha384-j0CNLUeiqtyaRmlzUHCPZ+Gy5fQu0dQ6eZ/xAww941Ai1SxSY+0EQqNXNE6DZiVc" crossorigin="anonymous"></script>

      <script type='module'>
        import renderScreen from '../renderScreen.js';
        import keyboardListener from '../keyboardListener.js';
        import createGame from '../game.js';

        var socket = io();
        var game = createGame();
        var keyboard = keyboardListener();
        var myScreen = document.getElementById("myScreen").getContext('2d');
        
        socket.on('connect', () => {
          renderScreen(myScreen, game,requestAnimationFrame,socket.id);
        })
        
        socket.on('setup', (state) => {
            game.setState(state);
            
            keyboard.setPlayerId(socket.id);
            keyboard.subscrive(game.handleKeyDown);
            keyboard.subscrive( (command) => {
              socket.emit(command.type, command)
            })
        })

        socket.on('add-player', (command) => {
          game.addPlayer(command);
         })

        socket.on('remove-player', (command) => {
           game.removePlayer(command);
        })

        socket.on('move-player', (command) => {  
          if(socket.id !== command.playerId){
            game.handleKeyDown(command);   
          }                      
        })

      
        //
      
      </script>
</body>
<style>
  footer{
    bottom: 0;
    left: 0;
    position: fixed;
    width:100%;
    
  }

  #myScreen{
    border:5px solid #3385ff;
  }

</style>



</html>